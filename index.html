<!DOCTYPE html>
<html lang="en-us">
<head>
  <meta charset="utf-8">
  <title>My project</title>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.0.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.0.2/firebase-auth-compat.js"></script>
  <script src="https://accounts.google.com/gsi/client" async defer></script>

  <script>
    function StartGoogleLoginJS() {
      if (typeof google === 'undefined' || typeof firebase === 'undefined') {
        alert("구글 또는 파이어베이스 SDK가 로드되지 않았습니다.");
        return;
      }

      google.accounts.id.initialize({
        client_id: "920271608315-s4a4v4js2viqnf7lgofh826ljcvv8mqc.apps.googleusercontent.com",
        callback: (response) => {
          const credential = response.credential;
          const provider = firebase.auth.GoogleAuthProvider.credential(credential);

          firebase.auth().signInWithCredential(provider)
            .then((result) => {
              const user = result.user;
              const email = user?.email;

              if (!email) {
                alert("로그인 실패: 이메일 정보를 가져오지 못했습니다.");
                return;
              }

              // ❗ 정확하게 도메인 검사
              if (!email.toLowerCase().endsWith("@dimigo.hs.kr")) {
                alert("로그인 실패: 디미고 계정이 아닙니다.");
                if (typeof unityInstance !== 'undefined') {
                  unityInstance.SendMessage("FirebaseManager", "OnLoginFailed", "Not a Dimigo account");
                }
                return;
              }

              // ✅ 디미고 계정이면 성공 처리
              if (typeof unityInstance !== 'undefined') {
                unityInstance.SendMessage("FirebaseManager", "OnGoogleLogin", email);
              }
            })
            .catch((error) => {
              console.error("로그인 실패:", error.message);
              alert("로그인 실패: " + error.message);
              if (typeof unityInstance !== 'undefined') {
                unityInstance.SendMessage("FirebaseManager", "OnLoginFailed", error.message);
              }
            });
        }
      });

      google.accounts.id.prompt();
    }
  </script>


  <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0, user-scalable=no">
  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: #000;
      width: 100%;
      height: 100%;
      overflow: hidden;
    }
    #gameContainer {
      position: absolute;
      top: 0; left: 0;
      width: 100%;
      height: 100%;
    }
    canvas {
      width: 100%;
      height: 100%;
      display: block;
    }
  </style>
</head>

<body>
  <div id="gameContainer">
    <canvas id="unity-canvas"></canvas>
  </div>

  <script src="Build/f2.loader.js"></script>
  <script>
    var canvas = document.querySelector("#unity-canvas");
    var config = {
      dataUrl: "Build/f2.data",
      frameworkUrl: "Build/f2.framework.js",
      codeUrl: "Build/f2.wasm",
      streamingAssetsUrl: "StreamingAssets",
      companyName: "DefaultCompany",
      productName: "My project",
      productVersion: "1.0",
      matchWebGLToCanvasSize: true // 핵심!
    };

    createUnityInstance(canvas, config, (progress) => {
      canvas.style.background = `linear-gradient(to right, white ${progress * 100}%, transparent ${progress * 100}%) no-repeat center`;
      canvas.style.backgroundSize = '100% 1rem';
    }).then((instance) => {
      window.unityInstance = instance;
    }).catch((message) => {
      alert(message);
    });
  </script>
</body>
</html>
