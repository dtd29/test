<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>%UNITY_WEBGL_NAME%</title>
  <link rel="shortcut icon" href="%UNITY_WEBGL_BUILD_URL%/favicon.ico" />
  <style>
    body { margin: 0; padding: 0; background: #000; }
    #gameContainerId { width: 1920 px; height: 1080px; margin: auto; background: #000; }
  </style>

  <!-- UnityLoader.js -->
  <script src="%UNITY_WEBGL_LOADER_URL%"></script>

  <!-- Google Identity Services -->
  <script src="https://accounts.google.com/gsi/client" async defer></script>

  <script>
    let unityInstance = null;
    let client = null;

    function parseJwt(token) {
      const base64Url = token.split('.')[1];
      const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
      const jsonPayload = decodeURIComponent(atob(base64).split('').map(c => {
        return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
      }).join(''));
      return JSON.parse(jsonPayload);
    }

    function handleCredentialResponse(response) {
      const payload = parseJwt(response.credential);

      const userInfo = {
        name: payload.name,
        email: payload.email,
      };

      unityInstance.SendMessage("YourUnityGameObject", "OnGoogleLoginSuccess", JSON.stringify(userInfo));
    }


    function triggerGoogleLogin() {
      if (client) {
        google.accounts.id.prompt();
      } else {
        console.error("Google 로그인 클라이언트가 초기화되지 않았습니다.");
      }
    }

    window.onload = function () {
      unityInstance = UnityLoader.instantiate("gameContainerId", "%UNITY_WEBGL_BUILD_URL%/Build.json");

      client = google.accounts.id.initialize({
        client_id: "920271608315-s4a4v4js2viqnf7lgofh826ljcvv8mqc.apps.googleusercontent.com",
        callback: handleCredentialResponse
      });
    };
  </script>
</head>

<body>
  <div id="gameContainerId"></div>
</body>
</html>
