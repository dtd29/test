<!DOCTYPE html>
<html lang="en-us">
<head>
  <meta charset="utf-8" />
  <title>Unity WebGL Login</title>

  <!-- UnityLoader 로더 -->
  <script src="Build/UnityLoader.js"></script>

  <!-- Google Identity Services -->
  <script src="https://accounts.google.com/gsi/client" async defer></script>

  <script>
    let unityInstance = null;
    let client = null;

    function parseJwt(token) {
      const base64Url = token.split('.')[1];
      const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
      const jsonPayload = decodeURIComponent(atob(base64).split('').map(c => {
        return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
      }).join(''));
      return JSON.parse(jsonPayload);
    }

    function handleCredentialResponse(response) {
      const payload = parseJwt(response.credential);
      if (unityInstance && typeof unityInstance.SendMessage === "function") {
        unityInstance.SendMessage("YourUnityGameObject", "OnGoogleLoginSuccess", payload.name);
      } else {
        console.error("Unity가 아직 로딩되지 않았거나 SendMessage를 사용할 수 없습니다.");
      }
    }

    // Unity에서 호출할 로그인 트리거
    function triggerGoogleLogin() {
      if (client) {
        google.accounts.id.prompt();
      } else {
        console.error("Google 로그인 클라이언트가 초기화되지 않았습니다.");
      }
    }

    window.onload = function () {
      // ✅ Unity 인스턴스화 (UnityLoader 사용)
      unityInstance = UnityLoader.instantiate("gameContainerId", "Build/4.json");

      // ✅ Google 로그인 초기화
      client = google.accounts.id.initialize({
        client_id: "920271608315-s4a4v4js2viqnf7lgofh826ljcvv8mqc.apps.googleusercontent.com",
        callback: handleCredentialResponse
      });
    };
  </script>

  <style>
    body {
      margin: 0;
      padding: 0;
      background-color: #000;
    }
    #gameContainerId {
      width: 960px;
      height: 600px;
      margin: auto;
      background: #000;
    }
  </style>
</head>

<body>
  <!-- Unity WebGL 게임 위치 -->
  <div id="gameContainerId"></div>
</body>
</html>
